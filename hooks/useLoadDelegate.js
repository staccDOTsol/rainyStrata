import{SystemProgram as t}from"@solana/web3.js";import{ChatSdk as e}from"@strata-foundation/chat";import{useSolOwnedAmount as o}from"@strata-foundation/react";import{sendInstructions as a}from"@strata-foundation/spl-utils";import{useAsyncCallback as i}from"react-async-hook";import{useChatSdk as n}from"../contexts/chatSdk.js";import{useDelegateWallet as r,getKeypairFromMnemonic as s}from"./useDelegateWallet.js";import{useDelegateWalletStruct as l}from"./useDelegateWalletStruct.js";import{useDelegateWalletStructKey as c}from"./useDelegateWalletStructKey.js";import{generateMnemonic as p}from"bip39";async function u(o,i,n){if(i){const r=o&&(await e.delegateWalletKey(o.publicKey))[0],l=[],c=[];if(!(r&&await i.provider.connection.getAccountInfo(r))){if(!o){const t=p();o=s(t);const{instructions:e,signers:a}=await i.initializeSettingsInstructions({settings:{delegateWalletSeed:t}});l.push(...e),c.push(...a)}const{instructions:t,signers:e}=await i.initializeDelegateWalletInstructions({delegateWalletKeypair:o});l.push(...t),c.push(...e)}const u=(await i.provider.connection.getAccountInfo(o.publicKey))?.lamports,m=n*Math.pow(10,9);(u||0<m)&&l.push(t.transfer({fromPubkey:i.wallet.publicKey,toPubkey:o.publicKey,lamports:m})),await a(i.errors||new Map,i.provider,l,c)}}function m(){const{keypair:t,mnemonic:e,loading:a,error:s}=r(),{key:p,loading:m}=c(t?.publicKey),{account:d,loading:f}=l(p),{amount:g,loading:y}=o(t?.publicKey),{execute:b,error:h,loading:w}=i(u),{chatSdk:K}=n();return{delegateWallet:t,mnemonic:e,loadingNeeds:a||f||y||m,needsInit:!(a||f||m||d),needsTopOff:!a&&t&&!y&&g<1e-5,loadDelegate:e=>b(t,K,e),loading:w,error:h||s}}export{m as useLoadDelegate};
//# sourceMappingURL=useLoadDelegate.js.map
