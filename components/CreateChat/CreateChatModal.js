import{jsxs as s,jsx as e,Fragment as t}from"react/jsx-runtime";import{useReducer as i,useCallback as o,useEffect as a}from"react";import{Modal as n,ModalOverlay as r,ModalContent as m,ModalHeader as p,VStack as d,Box as c,Text as l,HStack as f,ModalBody as u,Button as P}from"@chakra-ui/react";import{useWallet as v}from"@solana/wallet-adapter-react";import{useWalletModal as y}from"@solana/wallet-adapter-react-ui";import{useStrataSdks as g}from"@strata-foundation/react";import{useChatSdk as S}from"../../contexts/chatSdk.js";import{useDelegateWallet as h}from"../../hooks/useDelegateWallet.js";import{ProgressStep as T}from"./ProgressStep.js";import{BasicInfo as j}from"./BasicInfo.js";import{PermissionType as b}from"./PermissionType.js";import{Permission as w}from"./Permission.js";import{Summary as k}from"./Summary.js";import{wizardSubmit as x}from"./wizardSubmit.js";import{useRouter as z}from"next/router";import{route as B,routes as R}from"../../routes.js";var I,O;!function(s){s[s.BasicInfo=0]="BasicInfo",s[s.ReadPermissionsType=1]="ReadPermissionsType",s[s.ReadPermissions=2]="ReadPermissions",s[s.PostPermissionsType=3]="PostPermissionsType",s[s.PostPermissions=4]="PostPermissions",s[s.Summary=5]="Summary"}(I||(I={})),function(s){s.prev=s=>s+-1,s.next=s=>s+1}(I||(I={})),function(s){s.Token="Token",s.NFT="NFT"}(O||(O={}));const C={step:I.BasicInfo,lastStep:I.BasicInfo,status:null,subStatus:null,error:null,wizardData:{name:"",identifier:"",image:void 0,imageUrl:void 0,imageUploaded:!1,readType:void 0,postType:void 0,postIsSameAsRead:!1,readForm:{isExisting:!1},postForm:{isExisting:!1}}},A=({isOpen:O,onClose:A})=>{const{connected:D}=v(),{setVisible:N}=y(),{chatSdk:W}=S(),F=z(),{tokenBondingSdk:E}=g(),{keypair:U}=h(),[V,L]=i(((s,e)=>({...s,...e})),C),q=()=>{L(C),A()},G=o((async()=>{const s=V.step===I.Summary;(!s&&I.next(V.lastStep))==I.Summary?L({step:I.Summary}):s?await x({sdks:{chatSdk:W,tokenBondingSdk:E},data:V,delegateWallet:U,setState:L}):V.step===I.PostPermissionsType&&V.wizardData.postIsSameAsRead?L({step:I.Summary,lastStep:V.step}):L({step:I.next(V.step),lastStep:V.step})}),[V,L]),H=o((s=>{s&&s in I?L({step:s}):V.step===I.BasicInfo?(L(C),A()):V.step===I.Summary&&V.wizardData.postIsSameAsRead?L({step:I.PostPermissionsType}):L({step:I.prev(V.step)})}),[V,L,A]);return a((()=>{"success"===V.status&&(F.push(B(R.chat,{id:V.wizardData.identifier}),void 0,{shallow:!0}),q())}),[V.status]),s(n,Object.assign({onClose:q,isOpen:O,size:"lg"},{children:[e(r,{},void 0),s(m,Object.assign({pb:5},{children:[e(p,Object.assign({textAlign:"left"},{children:s(d,Object.assign({w:"full",alignItems:"start",gap:8,spacing:0},{children:[s(c,{children:[e(l,Object.assign({fontWeight:"bold",fontSize:"lg"},{children:"Create a Chat"}),void 0),e(l,Object.assign({fontSize:"sm",fontWeight:"normal"},{children:"This information will help us create your chat..."}),void 0)]},void 0),s(f,Object.assign({w:"full",justifyContent:"space-between",pb:4},{children:[e(T,{step:1,size:"sm",isActive:V.step===I.BasicInfo,isCompleted:V.step>I.BasicInfo},void 0),e(T,{step:2,size:"sm",isActive:[I.ReadPermissionsType,I.ReadPermissions].includes(V.step),isCompleted:V.step>I.ReadPermissions},void 0),e(T,{step:3,size:"sm",isActive:[I.PostPermissionsType,I.PostPermissions].includes(V.step),isCompleted:V.step>I.PostPermissions,isLast:!0},void 0)]}),void 0)]}),void 0)}),void 0),e(u,{children:D?s(t,{children:[V.step===I.BasicInfo&&e(j,{state:V,setState:L,onBack:H,onNext:G},void 0),[I.ReadPermissionsType,I.PostPermissionsType].includes(V.step)&&e(b,{state:V,setState:L,permissionType:{[I.ReadPermissionsType]:"read",[I.PostPermissionsType]:"post"}[V.step],defaultValue:{[I.ReadPermissionsType]:V.wizardData.readType,[I.PostPermissionsType]:V.wizardData.postType}[V.step],onBack:H,onNext:G},void 0),[I.ReadPermissions,I.PostPermissions].includes(V.step)&&e(w,{state:V,permissionType:{[I.ReadPermissions]:"read",[I.PostPermissions]:"post"}[V.step],setState:L,onBack:H,onNext:G},void 0),V.step===I.Summary&&e(k,{state:V,onBack:H,onNext:G},void 0)]},void 0):s(d,Object.assign({w:"full",alignItems:"start",gap:6,spacing:0},{children:[s(c,{children:[e(l,Object.assign({fontWeight:"bold",fontSize:"md"},{children:"No wallet was detected"}),void 0),e(l,Object.assign({fontSize:"xs",fontWeight:"normal"},{children:"Please connect a wallet to continue."}),void 0)]},void 0),e(P,Object.assign({variant:"outline",colorScheme:"primary",onClick:()=>{A(),N(!0)}},{children:"Connect Wallet"}),void 0)]}),void 0)},void 0)]}),void 0)]}),void 0)};export{A as CreateChatModal,I as CreateChatStep,O as ReadPostType,C as initialState};
//# sourceMappingURL=CreateChatModal.js.map
