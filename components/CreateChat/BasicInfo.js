import{jsx as e,jsxs as i}from"react/jsx-runtime";import{useRef as a,useState as t,useCallback as r,useEffect as o}from"react";import{useForm as n}from"react-hook-form";import{yupResolver as s}from"@hookform/resolvers/yup";import*as l from"yup";import{VStack as d,Box as c,Text as m,Input as g,FormControl as h,FormLabel as f,InputGroup as p,InputRightElement as v,FormHelperText as u,Flex as b,Icon as j,FormErrorMessage as w,HStack as y,Button as O,Image as x,Progress as z,ButtonGroup as S}from"@chakra-ui/react";import{RiCheckLine as k,RiCheckboxCircleFill as D,RiErrorWarningFill as U}from"react-icons/ri";import{useWallet as C}from"@solana/wallet-adapter-react";import{randomizeFileName as I,uploadFiles as T}from"@strata-foundation/chat";import{useErrorHandler as W}from"@strata-foundation/react";import{useChatSdk as q}from"../../contexts/chatSdk.js";import{useChatStorageAccountKey as F}from"../../hooks/useChatStorageAccountKey.js";import{useLoadDelegate as E}from"../../hooks/useLoadDelegate.js";import{useWalletFromChatIdentifier as L}from"../../hooks/useWalletFromChatIdentifier.js";import{FormControlWithError as N}from"../form/FormControlWithError.js";const A=l.object({name:l.string().required().max(28),identifier:l.string().required().max(28).matches(/^[a-zA-Z0-9\_]+$/g,"must be alphanumeric and not have any spaces"),image:l.mixed(),imageUrl:l.string()}).required(),B=({state:l,setState:B,onBack:_,onNext:K})=>{const{publicKey:R}=C(),{chatSdk:V}=q(),{handleErrors:P}=W();F();const Y=a(null),{imageUploaded:Z}=l.wizardData,[$,G]=t(!1),[H,J]=t(),[M,Q]=t(null),{delegateWallet:X,error:ee}=E();P(ee);const{register:ie,handleSubmit:ae,watch:te,formState:{errors:re},setValue:oe,setError:ne,clearErrors:se}=n({mode:"onChange",resolver:s(A),defaultValues:{...l.wizardData}}),{name:le,identifier:de,image:ce,imageUrl:me}=te(),{wallet:ge}=L(de),he={bg:"gray.200",_dark:{bg:"gray.800"}},fe={color:"black",_dark:{color:"gray.400"}},pe=r(((e,i,a)=>{if(""===e)Q(null),se("identifier");else if(e.length>=6){const e=i?.equals(a);!i||e?Q(!0):(Q(!1),ne("identifier",{message:".chat domain is already taken!"}))}}),[]);o((()=>{pe(de,ge,R)}),[de,ge]);return o((()=>{(async()=>{if(ce){const e=new FileReader;if(e.onload=e=>{J(e.target?.result||"")},e.readAsDataURL(ce),!me){G(!0),I(ce);let e=!1;try{const i=await T(V.provider,[ce],X);i&&i.length>0&&(oe("imageUrl",i[0]),e=!0,B({...l,wizardData:{...l.wizardData,imageUploaded:!0}}))}catch(e){P(e)}finally{G(!1),e||(oe("imageUrl",void 0),oe("image",void 0),J(void 0),ne("image",{message:"Image failed to upload, please try again"}),Y.current&&(Y.current.value=""))}}}else J(void 0)})()}),[ce]),e("form",Object.assign({onSubmit:ae((e=>{e.identifier.length<6&&!ge?.equals(R)?ne("identifier",{message:"Domain must be at least 6 characters."}):(B({...l,wizardData:{...l.wizardData,...e,imageUploaded:!0}}),K())}))},{children:i(d,Object.assign({w:"full",alignItems:"start",gap:6,spacing:0},{children:[i(c,{children:[e(m,Object.assign({fontWeight:"bold",fontSize:"md"},{children:"Let's Start with the Basic info"}),void 0),e(m,Object.assign({fontSize:"xs",fontWeight:"normal"},{children:"What do you want your chat to be called?"}),void 0)]},void 0),e(N,Object.assign({id:"name",label:"Name",errors:re,help:"The name that will apper in the sidebar."},{children:e(g,Object.assign({id:"name",variant:"filled"},he,ie("name")),void 0)}),void 0),i(h,Object.assign({isInvalid:!!re.identifier?.message},{children:[e(f,Object.assign({htmlFor:"identifier"},{children:".chat Domain"}),void 0),i(p,{children:[e(g,Object.assign({id:"identifier",variant:"filled"},he,ie("identifier")),void 0),M&&e(v,{children:e(k,{fontSize:"1.5rem"},void 0)},void 0)]},void 0),re.identifier?.message?i(w,Object.assign({fontSize:"xs",textTransform:"capitalize"},{children:[e(j,{as:U,mr:1,fontSize:"1.3rem"},void 0),re.identifier.message]}),void 0):e(u,Object.assign({fontSize:"xs"},fe,{alignItems:"center",justifyContent:"center"},{children:M?i(b,Object.assign({alignItems:"center",color:"green.500"},{children:[e(j,{as:D,mr:1,fontSize:"1.3rem"},void 0),e(c,{children:".chat domain is available!"},void 0)]}),void 0):'The shortlink for the chat, i.e "solana" for solana.chat. You will receive an NFT representing ownership of the chat domain.'}),void 0)]}),void 0),i(h,Object.assign({isInvalid:!!re.image?.message},{children:[e(f,{children:"Upload Picture"},void 0),i(y,Object.assign({w:"full",spacing:4},{children:[e(O,Object.assign({size:"sm",colorScheme:"primary",variant:"outline",onClick:()=>Y.current.click(),disabled:$},{children:"Choose Image"}),void 0),ce&&i(y,Object.assign({spacing:2,align:"center"},{children:[e(x,{alt:ce?.name,w:"32px",h:"32px",src:H},void 0),e(m,Object.assign({color:"gray.500"},{children:ce?.name}),void 0),Z&&e(j,{w:"22px",h:"22px",color:"green.400",as:D},void 0)]}),void 0)]}),void 0),e("input",{id:"image",type:"file",accept:".png,.jpg,.gif,.mp4,.svg",multiple:!1,onChange:e=>{const i=e.target.files[0];oe("image",i||null),se("image")},ref:Y,style:{display:"none"}},void 0),re.image?.message?i(w,Object.assign({fontSize:"xs",textTransform:"capitalize"},{children:[e(j,{as:U,mr:2,fontSize:"1.3rem"},void 0),re.image.message]}),void 0):e(u,Object.assign({fontSize:"xs"},fe,{children:"The image that will appear in the sidebar."}),void 0),$&&e(z,{size:"xs",isIndeterminate:!0,colorScheme:"orange",mt:2},void 0)]}),void 0),i(S,Object.assign({variant:"outline",colorScheme:"primary",w:"full"},{children:[e(O,Object.assign({w:"full",onClick:_},{children:"Back"}),void 0),e(O,Object.assign({w:"full",variant:"solid",type:"submit",disabled:!le||!M||!me&&!ce||$||!Z,isLoading:$,loadingText:"Uploading image"},{children:"Next"}),void 0)]}),void 0)]}),void 0)}),void 0)};export{B as BasicInfo};
//# sourceMappingURL=BasicInfo.js.map
