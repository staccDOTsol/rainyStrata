import{jsxs as o,jsx as e}from"react/jsx-runtime";import{ChatboxWithGuards as r}from"./chatbox/ChatboxWithGuards.js";import{ChatMessages as t}from"./ChatMessages.js";import{EmojiPickerPopover as a}from"./EmojiPicker.js";import{FileUploadMask as i}from"./FileUploadMask.js";import{useMessages as s}from"../hooks/useMessages.js";import{Flex as n}from"@chakra-ui/react";import{randomizeFileName as c}from"@strata-foundation/chat";import{useErrorHandler as m}from"@strata-foundation/react";import{useState as d,useEffect as f,useMemo as l,useCallback as h}from"react";import{useAsyncCallback as p}from"react-async-hook";import{useDropzone as g}from"react-dropzone";const u={bg:"gray.900"},v=({chatKey:v,accelerated:w,fetcher:k})=>{const{handleErrors:M}=m(),[j,y]=d([]),[b,x]=d([]),{messages:E,error:F,loadingInitial:K,loadingMore:L,hasMore:P,fetchMore:A,fetchNew:C}=s({chat:v,accelerated:w,fetcher:k,numTransactions:50});M(F);const{execute:T}=p((async function(){let o=E.length;for(;;){if(await C(50),E.length-o<50)break}}));f((()=>(window.addEventListener("focus",T),()=>{window.removeEventListener("focus",T)})));const z=l((()=>new Set(Array.from(E?.map((o=>o.id))||[]))),[E]);f((()=>{x((o=>o.filter((o=>!z.has(o.id)))))}),[z]);const B=l((()=>[...E||[],...b.filter((o=>!z.has(o.id)))].sort(((o,e)=>e.startBlockTime-o.startBlockTime))),[z,E,b]),D=h((o=>x((e=>[...e||[],o]))),[x]),I=h((async o=>{y((e=>[...e,...[...o].map((o=>{const e={name:o.name,file:o};return c(o),e}))]))}),[y]),{getRootProps:N,getInputProps:O,open:U,isFocused:G,isDragAccept:R}=g({noClick:!0,noKeyboard:!0,onDrop:I}),S=l((()=>N({className:"dropzone"})),[N]);return o(n,Object.assign({position:"relative",direction:"column",w:"full",h:"full",grow:1,bg:"white",_dark:u,overflow:"hidden"},S,{children:[" ",(G||R)&&e(i,{},void 0),e("input",Object.assign({},O()),void 0),e(a,{chatKey:v},void 0),e(t,{isLoading:K,isLoadingMore:L,messages:B,hasMore:P,fetchMore:A},void 0),e(r,{chatKey:v,onAddPendingMessage:D,files:j,setFiles:y,onUploadFile:U},void 0)]}),void 0)};export{v as Chatroom};
//# sourceMappingURL=Chatroom.js.map
