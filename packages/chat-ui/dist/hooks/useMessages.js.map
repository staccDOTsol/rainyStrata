{"version":3,"file":"useMessages.js","sources":["../../src/hooks/useMessages.ts"],"sourcesContent":[null],"names":["txToMessages","async","getMessagesFromTxs","chat","chatSdk","txs","failedTx","Set","Array","from","filter","tx","meta","err","map","signature","newParts","Promise","all","sig","transaction","pending","blockTime","found","getMessagePartsFromInflatedTx","txid","f","e","console","warn","flat","truthy","getMessagesFromParts","msg","txids","every","has","message","parts","some","p","cachedReacts","mergeMessages","message1","message2","complete","a","b","item","size","set","allParts","concat","nonPendingParts","getMessageFromParts","part","add","reduceMessages","messageState","messages","reduce","acc","existing","id","MESSAGE_LAMBDA","lambdaFetcher","args","res","fetch","body","JSON","stringify","method","headers","Accept","json","d","Number","blocktime","readPermissionAmount","BN","readPermissionKey","PublicKey","sender","signer","totalParts","currentPart","useMessages","accelerated","numTransactions","fetcher","useChatSdk","info","chatAcc","useChat","cluster","useEndpoint","useFetcher","postMessageProgramId","equals","ChatSdk","ID","rawMessages","setRawMessages","useState","transactions","loadingInitial","rest","useTransactions","address","subscribe","lazy","stablePubkey","usePublicKey","toBase58","useEffect","Object","fromEntries","entries","entry","chatKey","currentTime","useMemo","Date","now","variables","minBlockTime","maxBlockTime","offset","limit","fetchFn","useCallback","resolve","loading","fetchLoading","result","fetchedMessageParts","error","fetchError","execute","runFetch","useAsyncCallback","txMessages","useAsync","fetchMore","values","sort","startBlockTime","messagesWithReactsAndReplies","reacts","type","MessageType","React","referenceMessageId","push","messagesById","cachedReactsLocal","length","reply","hasMore","Boolean","num","fetchNew","valueOf","loadingMore"],"mappings":"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"}